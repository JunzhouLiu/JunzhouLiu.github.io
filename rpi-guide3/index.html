<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>树莓派4B食用指南（三、从USB存储设备启动Ubuntu Server） | 绝知此事要躬行</title>
    <meta name="generator" content="VuePress 1.5.2">
    <meta name="description" content="Happy Coding">
    <link rel="preload" href="/assets/css/0.styles.91d6fc86.css" as="style"><link rel="preload" href="/assets/js/app.1989c4a1.js" as="script"><link rel="preload" href="/assets/js/8.f2e57df2.js" as="script"><link rel="preload" href="/assets/js/24.3322d388.js" as="script"><link rel="prefetch" href="/assets/js/1.07893bf2.js"><link rel="prefetch" href="/assets/js/10.9415cf1d.js"><link rel="prefetch" href="/assets/js/11.be7da0a5.js"><link rel="prefetch" href="/assets/js/12.7c61dc2f.js"><link rel="prefetch" href="/assets/js/13.2733a3fa.js"><link rel="prefetch" href="/assets/js/14.a919dfeb.js"><link rel="prefetch" href="/assets/js/15.5bdcdba9.js"><link rel="prefetch" href="/assets/js/16.4a4a5c0a.js"><link rel="prefetch" href="/assets/js/17.79bd31a0.js"><link rel="prefetch" href="/assets/js/18.ca834c4e.js"><link rel="prefetch" href="/assets/js/19.1706f49e.js"><link rel="prefetch" href="/assets/js/20.8e25cccf.js"><link rel="prefetch" href="/assets/js/21.0a1583a9.js"><link rel="prefetch" href="/assets/js/22.6e308db6.js"><link rel="prefetch" href="/assets/js/23.9767e7b6.js"><link rel="prefetch" href="/assets/js/25.ec6ff04f.js"><link rel="prefetch" href="/assets/js/26.52cde9da.js"><link rel="prefetch" href="/assets/js/27.212409c4.js"><link rel="prefetch" href="/assets/js/3.70fd8498.js"><link rel="prefetch" href="/assets/js/4.f1e934ed.js"><link rel="prefetch" href="/assets/js/5.3404dd88.js"><link rel="prefetch" href="/assets/js/6.555d6c9b.js"><link rel="prefetch" href="/assets/js/7.65bcdf9c.js"><link rel="prefetch" href="/assets/js/9.b042b7b8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.91d6fc86.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" style="background-size:cover;background-repeat:no-repeat;background-position:center;background-attachment:scroll;background-image:url(/assets/img/background.svg);" data-v-7a046aea><div data-v-e4145d0a data-v-7a046aea><nav class="navbar" data-v-e4145d0a><div class="container" data-v-e4145d0a><a href="/" class="router-link-active" data-v-e4145d0a><span class="navbar-site-name" data-v-e4145d0a>
          绝知此事要躬行
        </span></a> <div class="navbar-toggler" data-v-e4145d0a><svg class="icon" style="font-size:1.2em;" data-v-e4145d0a data-v-e4145d0a><title data-v-e4145d0a data-v-e4145d0a>menu</title><use xlink:href="#icon-menu" data-v-e4145d0a data-v-e4145d0a></use></svg></div> <div class="navbar-links" data-v-e4145d0a><a href="/" class="navbar-link" data-v-e4145d0a>
            Home
          </a><a href="/posts/" class="navbar-link" data-v-e4145d0a>
            Post
          </a><a href="/friend/" class="navbar-link" data-v-e4145d0a>
            Friends
          </a><a href="/about/" class="navbar-link" data-v-e4145d0a>
            AboutMe
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-e4145d0a></div></div> <div class="banner" data-v-98d6aa8c data-v-7a046aea data-v-7a046aea><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-7a046aea>
          树莓派4B食用指南（三、从USB存储设备启动Ubuntu Server）
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-4dd605a1 data-v-4dd605a1><main class="main" data-v-4dd605a1><div class="post" data-v-4dd605a1 data-v-4dd605a1><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2021-02-05
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2021-02-04
    </span></section> <section class="post-links" data-v-4e23451f><a href="/rpi-guide2/" class="post-link" data-v-4e23451f>
      上一篇 : 树莓派4B食用指南（二、搭建家庭网盘）
    </a> <!----></section></section> <article class="main-div"><div class="post-content content content__default"><h2 id="引言"><a href="#引言" class="header-anchor">#</a> 引言</h2> <p>树莓派4B在2020年中支持了从USB存储设备引导启动，这意味着给树莓派提供了更多的可玩性和更强大的存储性能，毕竟SD卡（TF卡）的读写速度太拉跨了，使用USB引导，我们就可以将系统从SSD或者HDD中启动。
由于部分出厂较早的树莓派是不支持USB引导的，原因并不是硬件不支持，而是EEPROM固件不支持，此时我们需要手动将<code>EEPROM</code>固件升级到<code>2020-09-03</code>版本，当然，得益于社区支持，以及树莓派4B目前是Ubuntu认证设备，升级EEPROM固件并不是一个复杂的工作，接下来我将会提供两个升级方式供大家选择。</p> <p>如果你有一张TF卡，并且已经写入了<code>Ubuntu Server 20.04 （20.10）</code>系统，我建议你采用方式1，如果手头的SD卡（TF）卡是空卡，则也可以使用方式2，如果是刚接触小板子的萌新，建议选择方式2。</p> <h2 id="方式1-使用rpi-eeprom"><a href="#方式1-使用rpi-eeprom" class="header-anchor">#</a> 方式1:使用rpi-eeprom</h2> <ol><li>安装<code>rpi-eeprom</code>,如果已安装，建议先更新一下。</li></ol> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y rpi-eeprom
</code></pre></div><ol start="2"><li>将当前引导加载程序配置写入到文本。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>sudo vcgencmd bootloader_config &gt; bootconf.txt
</code></pre></div><p>此时通过cat命令你如果看到如下格式的内容，说明引导配置成功导出了。</p> <div class="language- extra-class"><pre class="language-text"><code>root@Raspberry-Pi4:/home# cat bootconf.txt 
[all]
BOOT_UART=0
WAKE_ON_GPIO=1
POWER_OFF_ON_HALT=0
DHCP_TIMEOUT=45000
DHCP_REQ_TIMEOUT=4000
TFTP_FILE_TIMEOUT=30000
ENABLE_SELF_UPDATE=1
DISABLE_HDMI=0
BOOT_ORDER=0xf41
</code></pre></div><ol start="3"><li>修改引导模式的优先级，通过sed命令，将<code>BOOT_ORDER</code>选项的值改为<code>0xf41</code>，如果你喜欢nano或者vim也可以使用nano和vim对选项进行修改。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>sed -i -e '/^BOOT_ORDER=/ s/=.*$/=0xf41/' bootconf.txt
</code></pre></div><p><strong>ps：其实<code>2020-09-03</code>版本的<code>EEPROM</code>，<code>bootloader</code>配置默认的<code>BOOT_ORDER</code>值就是<code>0xf41</code>,如果走到这一步你发现这个值已经是<code>0xf41了</code> ,可以使用<code>sudo vcgencmd bootloader_version</code>命令确认下<code>bootloader</code>版本，如果是<code>2020-09-03</code>版本则无需再更新<code>EEPROM</code>了。命令输出的内容大致长下面这个样</strong></p> <div class="language- extra-class"><pre class="language-text"><code>root@Raspberry-Pi4:/home# sudo vcgencmd bootloader_version
Sep  3 2020 13:11:43
version c305221a6d7e532693cc7ff57fddfc8649def167 (release)
timestamp 1599135103
update-time 0
capabilities 0x00000000
</code></pre></div><p><strong>也可以使用<code>sudo rpi-eeprom-update</code>命令查看<code>EEPROM</code>固件版本。</strong></p> <div class="language- extra-class"><pre class="language-text"><code>root@Raspberry-Pi4:/home# sudo rpi-eeprom-update
BCM2711 detected
VL805 firmware in bootloader EEPROM
BOOTLOADER: up-to-date
CURRENT: Thu Sep  3 12:11:43 UTC 2020 (1599135103)
 LATEST: Thu Sep  3 12:11:43 UTC 2020 (1599135103)
 FW DIR: /lib/firmware/raspberrypi/bootloader/default
VL805: up-to-date
CURRENT: 000138a1
 LATEST: 000138a1
</code></pre></div><p>这里插入点刘同学的碎碎念：这里我来解释下<code>0xf41</code>是个啥意思，毕竟啃了好大一会英文文档，如果不分享给大家，有点点不太好，哈哈哈。</p> <p>首先是<code>0xf</code>前缀，也就是<code>RESTART</code>模式，他会重复尝试配置的引导顺序，1代表从SD卡启动，4代表从USB存储设备上启动，启动顺序由启动代码从右到左开始尝试，<code>0xf41</code>意味着会优先尝试从SD卡启动，如果没插卡，或者卡上没有系统则尝试从USB存储设备启动，并且按照这个顺序持续尝试。</p> <p>附表</p> <table><thead><tr><th>Value</th> <th>Mode</th> <th>Description</th></tr></thead> <tbody><tr><td>0x1</td> <td>SD CARD</td> <td>SD card (or eMMC on Compute Module 4)</td></tr> <tr><td>0x2</td> <td>NETWORK</td> <td>Network boot</td></tr> <tr><td>0x3</td> <td>RPIBOOT</td> <td>RPIBOOT -  See <a href="https://github.com/raspberrypi/usbboot" title="usbboot" target="_blank" rel="noopener noreferrer">usbboot<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>  (since 2020-09-03)</td></tr> <tr><td>0x4</td> <td>USB-MSD</td> <td>USB mass storage boot (since 2020-09-03)</td></tr> <tr><td>0x5</td> <td>BCM-USB-MSD</td> <td>USB 2.0 boot from USB Type-C socket or USB Type-A socket on CM4 IO board.     (since 2020-12-14)</td></tr> <tr><td>0xe</td> <td>STOP</td> <td>Stop and display error pattern (since 2020-09-03). A power cycle is required to exit this state.</td></tr> <tr><td>0xf</td> <td>RESTART</td> <td>Start again with the first boot order field. (since 2020-09-03)</td></tr></tbody></table> <p>在树莓派基金会官网上，提供了详细的bootloader config文档，如果你有兴趣可以去阅读一下。</p> <blockquote><p><a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2711_bootloader_config.md" title="Raspberry Pi 4 bootloader configuration" target="_blank" rel="noopener noreferrer">Raspberry Pi 4 bootloader configuration<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <ol start="4"><li>使用修改后的文本配置生成新的EEPROM副本。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>rpi-eeprom-config --out pieeprom-new.bin --config bootconf.txt /lib/firmware/raspberrypi/bootloader/critical/pieeprom-2020-09-03.bin
</code></pre></div><ol start="5"><li>配置下次重启时输入新的EEPROM固件。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>sudo rpi-eeprom-update -d -f ./pieeprom-new.bin
</code></pre></div><ol start="6"><li>重启以应用更改</li></ol> <div class="language- extra-class"><pre class="language-text"><code>sudo reboot
</code></pre></div><h2 id="方式2-使用raspberry-pi-imager"><a href="#方式2-使用raspberry-pi-imager" class="header-anchor">#</a> 方式2:使用Raspberry Pi Imager</h2> <p><a href="https://www.raspberrypi.org/software/" title="Raspberry Pi Imager 可在树莓派基金会官网获取" target="_blank" rel="noopener noreferrer">Raspberry Pi Imager 可在树莓派基金会官网获取<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li>打开Raspberry Pi Imager，点击CHOOSE OS选择<code>Misc Utillty images</code></li></ol> <p><img src="https://junzhouwechat.oss-cn-hangzhou.aliyuncs.com/1_20210204130703.png" alt="选择Misc Utillty images"></p> <ol start="2"><li>选择2020-9-14版本的EEPROM固件（实际就是2020-09-3版本）</li></ol> <p><img src="https://junzhouwechat.oss-cn-hangzhou.aliyuncs.com/2_20210204130703.png" alt="选择固件"></p> <p>3.选择要写入的存储设备（必须是SD/TF卡），刷入，将卡插入树莓派，给树莓派通电即可，大约60s就能完成刷入，之后断电拔卡就行了。</p> <h2 id="哪些系统支持直接从usb存储设备启动？"><a href="#哪些系统支持直接从usb存储设备启动？" class="header-anchor">#</a> 哪些系统支持直接从USB存储设备启动？</h2> <p>首先Raspberry PI OS 是肯定支持的。</p> <p>Ubuntu 系列，目前直接确认支持的有<code>Ubuntu Server 20.10</code>和<code>Ubuntu Desktop 20.10</code></p> <p>至于<code>Ubuntu Server 20.04.1</code>则需要通过一些特殊的方式使其支持，至于这两天要发布的<code>Ubuntu Server 20.04.2</code>我还没测试过，不过大概率的会支持.</p> <h2 id="目前兼容的usb适配器有哪些？"><a href="#目前兼容的usb适配器有哪些？" class="header-anchor">#</a> 目前兼容的USB适配器有哪些？</h2> <p><code>James A. Chambers</code>测试并维护了一个支持列表，里面包含了目前已知工作良好以及无法工作的设备列表，我就不直接放列表了，放了页面地址，大家可以自行查看。</p> <blockquote><p><a href="https://jamesachambers.com/raspberry-pi-4-usb-boot-config-guide-for-ssd-flash-drives/" title="兼容的usb适配器列表" target="_blank" rel="noopener noreferrer">兼容的usb适配器列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2021-02-05
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2021-02-04
    </span></section> <section class="post-links" data-v-4e23451f><a href="/rpi-guide2/" class="post-link" data-v-4e23451f>
      上一篇 : 树莓派4B食用指南（二、搭建家庭网盘）
    </a> <!----></section></section> <!----></div></main> <aside class="aside" data-v-4dd605a1><div class="info-card main-div" data-v-9d847660 data-v-4dd605a1><div class="info-card-header" data-v-9d847660><img src="/assets/img/avatar.png" alt="Junzhou" class="info-avatar" data-v-9d847660></div> <div class="info-card-body" data-v-9d847660><section class="info-nickname" data-v-9d847660>
      Junzhou
    </section> <section class="info-desc" data-v-9d847660>Happy Coding<br/>Happy Life<br/>Developer,Student</section> <section class="info-contact" data-v-9d847660><section data-v-9d847660><span title="XinYang City, China" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>XinYang City, China</title><use xlink:href="#icon-location" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          XinYang City, China
        </span></span></section> <!----> <section data-v-9d847660><a href="mailto:Junzhou2016@outlook.com" title="Junzhou2016@outlook.com" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>Junzhou2016@outlook.com</title><use xlink:href="#icon-email" data-v-9d847660 data-v-9d847660></use></svg><span class="info-text" data-v-9d847660 data-v-9d847660>
          Junzhou2016@outlook.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-9d847660><section class="info-sns clearfix" data-v-9d847660><a href="https://github.com/JunzhouLiu" target="_blank" class="sns-link" data-v-9d847660><span title="GitHub: JunzhouLiu" class="sns-icon" data-v-9d847660 data-v-9d847660><svg class="icon" style="font-size:1.5em;" data-v-9d847660 data-v-9d847660><title data-v-9d847660 data-v-9d847660>GitHub: JunzhouLiu</title><use xlink:href="#icon-github" data-v-9d847660 data-v-9d847660></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-4dd605a1><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/rpi-guide3/#引言">引言</a></li><li><a href="/rpi-guide3/#方式1-使用rpi-eeprom">方式1:使用rpi-eeprom</a></li><li><a href="/rpi-guide3/#方式2-使用raspberry-pi-imager">方式2:使用Raspberry Pi Imager</a></li><li><a href="/rpi-guide3/#哪些系统支持直接从usb存储设备启动？">哪些系统支持直接从USB存储设备启动？</a></li><li><a href="/rpi-guide3/#目前兼容的usb适配器有哪些？">目前兼容的USB适配器有哪些？</a></li></ul></div></div> <!----></div></aside></div> <footer class="footer" data-v-1375e54c><p class="footer-sns-links" data-v-1375e54c><a href="https://github.com/JunzhouLiu" target="_blank" class="sns-link" data-v-1375e54c><span title="GitHub: JunzhouLiu" class="sns-icon" data-v-1375e54c data-v-1375e54c><svg class="icon" style="font-size:25px;" data-v-1375e54c data-v-1375e54c><title data-v-1375e54c data-v-1375e54c>GitHub: JunzhouLiu</title><use xlink:href="#icon-github" data-v-1375e54c data-v-1375e54c></use></svg></span></a></p> <!----> <p class="footer-text" data-v-1375e54c>Copyright 2018-2020 | Junzhou Liu<br/><a href="https://beian.miit.gov.cn/" target="_blank">豫ICP备17043261号-1</a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1989c4a1.js" defer></script><script src="/assets/js/8.f2e57df2.js" defer></script><script src="/assets/js/24.3322d388.js" defer></script>
  </body>
</html>
