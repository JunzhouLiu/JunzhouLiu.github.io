(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{474:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),a("p",[t._v("继上次开箱树莓派4B也过了将近个把月了，期间也尝试过在树莓派上跑了一些服务，总体来讲8G版本的内存确实过剩，除了有次构建aarch64架构的docker镜像时内存占用一度上了40%之外，其余时间基本都在20%左右。今天就来讲讲如何使用树莓派打造私有网盘。上传下载50MB/S是问题不大滴,并且介绍的这两款开源网盘都有跨平台的客户端,支持流媒体播放,基本算是一个丐版NAS.")]),t._v(" "),a("h2",{attrs:{id:"情况介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#情况介绍"}},[t._v("#")]),t._v(" 情况介绍")]),t._v(" "),a("p",[t._v("我的树莓派是直接通过网线连在千兆的路由器上，我房间的网线也都是六类线，勉强算是千兆内网了。由于我之前使用的64G的金士顿TF卡插在树莓派上运行，内存卡做网盘的话，多少是有点局限性的，就不提读写瓶颈了，容量也是大个问题。（这个问题可以额外挂载一块硬盘），而我选择了直接通过USB3.0从1T的机械盘中启动系统，彻底抛开了TF卡。")]),t._v(" "),a("p",[a("img",{attrs:{src:"myrpi4.jpg",alt:""}}),t._v("\n在我房间基本就像这样,和路由器一起,emmmm 算是个文件服务器,也算是个aarch64的小型服务器.未来可能也算个家庭环境传感器的数据处理中心?(刘同学又在强行蹭高级词汇了 orz)")]),t._v(" "),a("p",[t._v("树莓派4B是支持原生USB启动的，但是要求bootloader版本比较新，可能需要卡刷下"),a("code",[t._v("EEPROM")]),t._v("。这部分我就不额外展开讲了，有兴趣的同学可以看看我上期的文章。（糟糕，忘了我还没写这篇文章）.")]),t._v(" "),a("p",[t._v("系统我采用了Ubuntu Server 20.10,之所所以选择20.10不选择20.04的原因是20.04的系统无法直接USB引导启动，需要额外的做一些配置（配置后会导致硬盘读写性能锐减，这里我没找到原因，通过TF卡引导USB接口上的硬盘启动20.04则没有这个问题），而20.10版本则可以直接启动。当然如果你使用TF卡跑在Ubuntu20.04上，按照本教程走也没有任何问题。")]),t._v(" "),a("p",[t._v("为什么选择Ubuntu，因为树莓派是Ubuntu的认证设备，可靠性是很强滴。")]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://ubuntu.com/blog/ubuntu-20-04-lts-is-certified-for-the-raspberry-pi",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ubuntu 20.04 LTS is certified for the Raspberry Pi"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://ubuntu.com/blog/raspberry-pi-and-ubuntu-2020-roundup",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspberry Pi and Ubuntu: 2020 roundup"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("关于网盘的选择，这里我选择了ownCloud和nextCloud，方式是使用Docker容器部署，因为部署方便，隔离性也比较好。")]),t._v(" "),a("p",[t._v("接下来废话就不多说了，直接开始搞起,基本全程命令配置，跟着教程走不易出错。")]),t._v(" "),a("h2",{attrs:{id:"前期准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前期准备"}},[t._v("#")]),t._v(" 前期准备")]),t._v(" "),a("h3",{attrs:{id:"使用清华大学的源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用清华大学的源"}},[t._v("#")]),t._v(" 使用清华大学的源")]),t._v(" "),a("p",[t._v("由于Ubuntu自己的源国内访问多少有那么些慢，所以这里我们采用tuna的源,请根据自己的系统版本选择对应的源。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先备份更新源文件")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" -p /etc/apt/sources.list /etc/apt/sources.list.bak\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改apt源文件,将Ubuntu自己的源用 # 注释。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" /etc/apt/sources.list\n")])])]),a("p",[a("strong",[t._v("Ubuntu20.04.1 LTS")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-security main restricted universe multiverse\n\n# 预发布软件源，不建议启用\n# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-proposed main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ focal-proposed main restricted universe multiverse\n")])])]),a("p",[a("strong",[t._v("Ubuntu20.10")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-updates main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-updates main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-backports main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-backports main restricted universe multiverse\ndeb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-security main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-security main restricted universe multiverse\n\n# 预发布软件源，不建议启用\n# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-proposed main restricted universe multiverse\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ groovy-proposed main restricted universe multiverse\n")])])]),a("p",[t._v("完成后执行以下命令更新下软解列表和软件。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo apt update\nsudo apt upgrade\n")])])]),a("h3",{attrs:{id:"安装依赖和docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装依赖和docker"}},[t._v("#")]),t._v(" 安装依赖和"),a("code",[t._v("Docker")])]),t._v(" "),a("ol",[a("li",[t._v("安装一些依赖和"),a("code",[t._v("docker-compose")]),t._v("，如果是20.10的系统，可能需要自己构建，这个过程中耐心等待即可。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo apt-get update && sudo apt-get install -y vim python3-pip curl git\npip3 install --upgrade pip\npip install docker-compose\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("安装"),a("code",[t._v("Docker")]),t._v(",其中"),a("code",[t._v("Docker")]),t._v("的安装可能较慢，需要耐心等。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 国内用户一键安装Docker，这个会快一些")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -sSL https://get.daocloud.io/docker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用docker的安装脚本安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -sSL get.docker.com "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("使用"),a("code",[t._v("docker -v")]),t._v("和"),a("code",[t._v("docker-compose -v")]),t._v("命令验证是否安装成功,如果出现类似的信息，则安装成功。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker -v")]),t._v("\nDocker version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20.10")]),t._v(".2, build 2291f61\n\nroot@Raspberry-Pi4:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose -v")]),t._v("\ndocker-compose version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.28")]),t._v(".0, build unknown\n\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("到目前为止我们的前置工具基本上已经安装到位了。在开始网盘的安装之前，我们为"),a("code",[t._v("Docker")]),t._v("配置个加速源，因为国内的网络问题，拉镜像可能会经常失败,依次执行如下命令即可。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /etc/docker\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tee")]),t._v(" /etc/docker/daemon.json "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<-")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'EOF\'\n{\n  "registry-mirrors": ["http://hub-mirror.c.163.com"]\n}\nEOF')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl restart docker\n")])])]),a("p",[t._v("再给大家额外提供几个镜像地址,需要的时候直接替换[]内的地址即可。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Docker中国区官方镜像\nhttps://registry.docker-cn.com\n\n中国科技大学\nhttps://docker.mirrors.ustc.edu.cn\n\n阿里云的镜像加速器需要申请自己的地址\nhttps://cr.console.aliyun.com/\n\n申请到的专属地址大概长这样：https://xxxxxx.mirror.aliyuncs.com\n")])])]),a("h2",{attrs:{id:"安装own-cloud"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装own-cloud"}},[t._v("#")]),t._v(" 安装own cloud")]),t._v(" "),a("ol",[a("li",[t._v("在"),a("code",[t._v("/home/")]),t._v("下创建个"),a("code",[t._v("ownCloud")]),t._v("文件夹，并且进入到这个目录。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo mkdir /home/ownCloud\ncd /home/ownCloud\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建云盘的配置文件，初始化的时候会将此配置文件作为云盘初始化的参数传递，用户名默和密码默认是admin,默认工作在8080端口，这个可以根据自己的需求自定义。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" EOF "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" .env\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OWNCLOUD_VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10.6")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("OWNCLOUD_DOMAIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("localhost:8088\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ADMIN_USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("admin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ADMIN_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("admin\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("HTTP_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8088")]),t._v("\nEOF\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("创建docker-compose.yml文件,数据库的相关密码和信息都写在了此文件中，参见owncloud的environment参数列表。不建议小白随意改动此文件。")])]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2.1'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("backup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("owncloud")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" owncloud/server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("OWNCLOUD_VERSION"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("HTTP_PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" db\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_DOMAIN=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("OWNCLOUD_DOMAIN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_DB_TYPE=mysql\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_DB_NAME=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_DB_USERNAME=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_DB_PASSWORD=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_DB_HOST=db\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_ADMIN_USERNAME=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ADMIN_USERNAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_ADMIN_PASSWORD=$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ADMIN_PASSWORD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_MYSQL_UTF8MB4=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_REDIS_ENABLED=true\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" OWNCLOUD_REDIS_HOST=redis\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("healthcheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CMD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/bin/healthcheck"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 30s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/mnt/data\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("db")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webhippie/mariadb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MARIADB_ROOT_PASSWORD=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MARIADB_USERNAME=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MARIADB_PASSWORD=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MARIADB_DATABASE=owncloud\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MARIADB_MAX_ALLOWED_PACKET=128M\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" MARIADB_INNODB_LOG_FILE_SIZE=64M\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("healthcheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CMD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/bin/healthcheck"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 30s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" backup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/backup\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" webhippie/redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" REDIS_DATABASES=1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("healthcheck")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("test")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CMD"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/bin/healthcheck"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 30s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 10s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/redis\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("使用"),a("code",[t._v("docker-compose up -d")]),t._v("命令启动网盘,第一次启动时需要拉取镜像,这个过程需要的时间取决于网络环境,当镜像拉取完成后,你看到如下输出时,意味着容器已经启动了.")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/home/ownCloud"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose up -d")]),t._v("\nBuilding with native build. Learn about native build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Compose here: https://docs.docker.com/go/compose-native-build/\n\nStarting owncloud_redis_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nStarting owncloud_db_1    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nStarting owncloud_owncloud_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])])]),a("p",[t._v("此时可以通过"),a("code",[t._v("docker-compose ps")]),t._v("命令查看容器的状态.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/home/ownCloud"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose ps")]),t._v("\n\n       Name                      Command                  State               Ports         \n--------------------------------------------------------------------------------------------\nowncloud_db_1         /usr/bin/entrypoint /bin/s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   Up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp              \nowncloud_owncloud_1   /usr/bin/entrypoint /usr/b "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   Up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:8088-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp\nowncloud_redis_1      /usr/bin/entrypoint /bin/s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".   Up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("healthy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("/tcp     \n\n")])])]),a("p",[t._v("耐心等待数分钟,会自动完成相关的初始化工作,此时,可以访问 "),a("code",[t._v("http://树莓派ip:8088")]),t._v(" 开始使用云盘.")]),t._v(" "),a("p",[a("img",{attrs:{src:"owncloudlogin.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"owncloudhome.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"ownclouddwonload.png",alt:""}})]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("问题排查,如果访问8088端口没有登录页面,那可能由于以下原因导致的.")])]),t._v(" "),a("ul",[a("li",[t._v("8088端口没有放行.执行"),a("code",[t._v("sudo ufw allow 8088")]),t._v("放行端口.")]),t._v(" "),a("li",[t._v("云盘初始化还没有完成.使用"),a("code",[t._v("docker-compose logs --follow owncloud")]),t._v("命令确诊初始化是否完成.如果有如下输入,则可以确定初始化已经完成了.")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("owncloud_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Writing apache config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nowncloud_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Enabling "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cron")]),t._v(" background"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nowncloud_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Set mode "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" background "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("jobs")]),t._v(" to "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cron'")]),t._v("\nowncloud_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Touching "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cron")]),t._v(" configs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nowncloud_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Starting "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cron")]),t._v(" daemon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nowncloud_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Starting apache daemon"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n")])])]),a("h2",{attrs:{id:"docker和docker-compose知识穿插混讲"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker和docker-compose知识穿插混讲"}},[t._v("#")]),t._v(" Docker和docker-compose知识穿插混讲")]),t._v(" "),a("p",[t._v("看了如上的教程,可能你还不是很理解执行的一些命令是什么意思,这里我穿插讲一下一些"),a("code",[t._v("docker")]),t._v("和"),a("code",[t._v("docker-compose")]),t._v("命令.")]),t._v(" "),a("h3",{attrs:{id:"docker-compose的常用管理命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose的常用管理命令"}},[t._v("#")]),t._v(" docker-compose的常用管理命令.")]),t._v(" "),a("p",[t._v("使用"),a("code",[t._v("docker-compose")]),t._v("命令前,我们要确认命令行已经进入了"),a("code",[t._v("docker-compose.yml")]),t._v("文件所在的目录,如果不在,那我们需要在命令中指定"),a("code",[t._v("docker-compose.yml")]),t._v("的位置路径.")]),t._v(" "),a("p",[t._v("例如"),a("code",[t._v("docker-compose -f /home/ownCloud/docker-compose.yml ps")]),t._v(" .")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("docker-compose up -d")]),t._v(" 启动容器并在后台运行")]),t._v(" "),a("li",[a("code",[t._v("docker-compose stop")]),t._v(" 停止已运行的容器")]),t._v(" "),a("li",[a("code",[t._v("docker-compose restart")]),t._v(" 重启容器")]),t._v(" "),a("li",[a("code",[t._v("docker-compose ps")]),t._v(" 列出容器")]),t._v(" "),a("li",[a("code",[t._v("docker-compose logs")]),t._v("查看日志")]),t._v(" "),a("li",[a("code",[t._v("docker-compose down")]),t._v("停止并且移除容器")]),t._v(" "),a("li",[a("code",[t._v("docker-compose help")]),t._v("查看所有命令")])]),t._v(" "),a("p",[t._v("以上这些命令可以在后面跟上容器名,指定要操作的容器.")]),t._v(" "),a("p",[t._v("例如"),a("code",[t._v("docker-compose stop owncloud_redis_1")])]),t._v(" "),a("h2",{attrs:{id:"docker命令"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker命令"}},[t._v("#")]),t._v(" Docker命令")]),t._v(" "),a("p",[t._v("Docker命令我这里只讲一个查看数据卷的命令,因为你使用"),a("code",[t._v("down")]),t._v("命令移除销毁云盘容器之后,不意味着你之前的数据就没了,当你再次启动容器时,这些数据依旧会存在.")]),t._v(" "),a("p",[t._v("所以我们可以通过"),a("code",[t._v("docker volume ls")]),t._v("命令查看所有的数据卷.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker volume ls")]),t._v("\nDRIVER    VOLUME NAME\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("     owncloud_backup\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("     owncloud_files\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("     owncloud_mysql\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("     owncloud_redis\n")])])]),a("p",[t._v("通过"),a("code",[t._v("docker volume rm 名称1 名称2")]),t._v("来移除这些数据卷,不移除的话,下次up -d数据依旧会存在.")]),t._v(" "),a("p",[t._v("通过"),a("code",[t._v("docker volume inspect 数据卷名称")]),t._v("来查看他们的具体位置.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker volume inspect owncloud_files ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CreatedAt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2021-01-26T12:46:24+08:00"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Labels"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.docker.compose.project"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"owncloud"')]),t._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.docker.compose.version"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.28.0"')]),t._v(",\n            "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"com.docker.compose.volume"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"files"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mountpoint"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/owncloud_files/_data"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"owncloud_files"')]),t._v(",\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Options"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" null,\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Scope"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h2",{attrs:{id:"安装nextcloud"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装nextcloud"}},[t._v("#")]),t._v(" 安装nextCloud")]),t._v(" "),a("p",[t._v("nextCloud这里我只介绍postgre数据库版本的安装方式.")]),t._v(" "),a("ol",[a("li",[t._v("在"),a("code",[t._v("/home/")]),t._v("下创建个"),a("code",[t._v("nextCloud")]),t._v("文件夹，并且进入到这个目录。")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo mkdir /home/nextCloud\ncd /home/nextCloud\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建云盘配置文件,同样的这些文件会在初始化服务时用到,两个"),a("code",[t._v("nextcloud_admin_xxx.txt")]),t._v("文件对应的是你登陆的账号和密码."),a("code",[t._v("postgres_db.txt")]),t._v("对应的是数据库名,以此类推.")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" nextcloud_admin_user.txt\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" admin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" nextcloud_admin_password.txt\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" nextcloud "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" postgres_db.txt\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" nextcloud "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" postgres_user.txt\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" nextcloud "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" postgres_password.txt\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("创建"),a("code",[t._v("docker-compose.yml")]),t._v(" ,默认启动端口为8080,如果需要指定端口只需要将app字段下的ports 修改为你想要设置的端口即可. 例如"),a("code",[t._v("- 9000:80")]),t._v(",注意,只需要修改左侧的端口号即可.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("version: '3.2'\n\nservices:\n  db:\n    image: postgres\n    restart: always\n    volumes:\n      - db:/var/lib/postgresql/data\n    environment:\n      - POSTGRES_DB_FILE=/run/secrets/postgres_db\n      - POSTGRES_USER_FILE=/run/secrets/postgres_user\n      - POSTGRES_PASSWORD_FILE=/run/secrets/postgres_password\n    secrets:\n      - postgres_db\n      - postgres_password\n      - postgres_user\n\n  app:\n    image: nextcloud\n    restart: always\n    ports:\n      - 8080:80\n    volumes:\n      - nextcloud:/var/www/html\n    environment:\n      - POSTGRES_HOST=db\n      - POSTGRES_DB_FILE=/run/secrets/postgres_db\n      - POSTGRES_USER_FILE=/run/secrets/postgres_user\n      - POSTGRES_PASSWORD_FILE=/run/secrets/postgres_password\n      - NEXTCLOUD_ADMIN_PASSWORD_FILE=/run/secrets/nextcloud_admin_password\n      - NEXTCLOUD_ADMIN_USER_FILE=/run/secrets/nextcloud_admin_user\n    depends_on:\n      - db\n    secrets:\n      - nextcloud_admin_password\n      - nextcloud_admin_user\n      - postgres_db\n      - postgres_password\n      - postgres_user\n\nvolumes:\n  db:\n  nextcloud:\n\nsecrets:\n  nextcloud_admin_password:\n    file: ./nextcloud_admin_password.txt # put admin password to this file\n  nextcloud_admin_user:\n    file: ./nextcloud_admin_user.txt # put admin username to this file\n  postgres_db:\n    file: ./postgres_db.txt # put postgresql db name to this file\n  postgres_password:\n    file: ./postgres_password.txt # put postgresql password to this file\n  postgres_user:\n    file: ./postgres_user.txt # put postgresql username to this file\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("使用"),a("code",[t._v("docker-compose up -d")]),t._v("命令启动.")])]),t._v(" "),a("p",[t._v("第一次启动时需要拉取镜像,这个过程需要的时间取决于网络环境,当镜像拉取完成后,你看到如下输出时,意味着容器已经启动了,耐心等待数分钟即可打开 "),a("code",[t._v("http://树莓派的ip:8080")]),t._v("开始登录使用网盘.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/home/nextCloud"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker-compose up -d")]),t._v("\nBuilding with native build. Learn about native build "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" Compose here: https://docs.docker.com/go/compose-native-build/\nCreating network "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nextcloud_default"')]),t._v(" with the default driver\nCreating nextcloud_db_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\nCreating nextcloud_app_1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n")])])]),a("p",[t._v("ps:容器启动状态为"),a("code",[t._v("done")]),t._v("的时候不意味着服务已经初始化完成,请使用"),a("code",[t._v("docker-compose logs --follow app")]),t._v(" 查看日志,确保初始化已经完全完成.")]),t._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[t._v("修改配置文件\n第一次登陆时,你可能会遇到如下提示")])]),t._v(" "),a("p",[a("img",{attrs:{src:"first.png",alt:""}})]),t._v(" "),a("p",[t._v("此时回一下我们提到docker查看数据卷位置命令,对,就是"),a("code",[t._v("docker volume")]),t._v("命令,查看下数据卷位置."),a("code",[t._v("docker volume inspect nextcloud_nextcloud")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('root@Raspberry-Pi4:/home/nextCloud# docker volume inspect nextcloud_nextcloud \n[\n    {\n        "CreatedAt": "2021-01-25T20:35:29+08:00",\n        "Driver": "local",\n        "Labels": {\n            "com.docker.compose.project": "nextcloud",\n            "com.docker.compose.version": "1.28.0",\n            "com.docker.compose.volume": "nextcloud"\n        },\n        "Mountpoint": "/var/lib/docker/volumes/nextcloud_nextcloud/_data",\n        "Name": "nextcloud_nextcloud",\n        "Options": null,\n        "Scope": "local"\n    }\n]\n\n')])])]),a("p",[t._v("然后我们cd到"),a("code",[t._v("/var/lib/docker/volumes/nextcloud_nextcloud/_data")]),t._v("目录,使用"),a("code",[t._v("nano config/config.php")]),t._v(" 修改"),a("code",[t._v("trusted_domains")]),t._v("配置.")]),t._v(" "),a("div",{staticClass:"language-php extra-class"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'trusted_domains'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("array")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'改为你树莓派的实际ip'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("p",[t._v("之后刷新,我们便可以登陆啦~~~")]),t._v(" "),a("p",[a("img",{attrs:{src:"nextcloudlogin.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"nextcloudhome.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"nextcloud的调优"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nextcloud的调优"}},[t._v("#")]),t._v(" nextCloud的调优")]),t._v(" "),a("ol",[a("li",[t._v("优化上传速度\n执行"),a("code",[t._v("docker exec -u 33 -it nextcloud_app_1 bash")]),t._v(" 使用33用户进入容器.\n执行"),a("code",[t._v("php occ config:app:set files max_chunk_size --value 0")]),t._v(" 取消块大小限制")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@Raspberry-Pi4:/home/nextCloud"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker exec -u 33 -it nextcloud_app_1 bash")]),t._v("\nwww-data@e0dd14717e86:~/html$ php occ config:app:set files max_chunk_size --value "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nConfig value max_chunk_size "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" app files "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" to "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("使用"),a("code",[t._v("nginx")]),t._v("代理,比如监听80,然后转到8080,不再赘述.")])]),t._v(" "),a("p",[t._v("感受下上传和下载速度吧~~")]),t._v(" "),a("p",[a("img",{attrs:{src:"uploadspeed.png",alt:""}}),t._v(" "),a("img",{attrs:{src:"nextclouddownload.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"参考列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考列表"}},[t._v("#")]),t._v(" 参考列表")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://doc.owncloud.org/server/10.6/admin_manual/installation/docker/",target:"_blank",rel:"noopener noreferrer"}},[t._v("owncloud"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/nextcloud/docker",target:"_blank",rel:"noopener noreferrer"}},[t._v("nextcloud/docker"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.docker.com/compose/reference/overview/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker/compose"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://mirror.tuna.tsinghua.edu.cn/help/ubuntu-ports/",target:"_blank",rel:"noopener noreferrer"}},[t._v("TUNA Ubuntu Ports"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://ubuntu.com/blog/ubuntu-20-04-lts-is-certified-for-the-raspberry-pi",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ubuntu 20.04 LTS is certified for the Raspberry Pi"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://ubuntu.com/blog/raspberry-pi-and-ubuntu-2020-roundup",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspberry Pi and Ubuntu: 2020 roundup"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);