(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{469:function(t,e,r){"use strict";r.r(e);var a=r(2),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"引言"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#引言"}},[t._v("#")]),t._v(" 引言")]),t._v(" "),r("p",[t._v("树莓派4B在2020年中支持了从USB存储设备引导启动，这意味着给树莓派提供了更多的可玩性和更强大的存储性能，毕竟SD卡（TF卡）的读写速度太拉跨了，使用USB引导，我们就可以将系统从SSD或者HDD中启动。\n"),t._v("\n由于部分出厂较早的树莓派是不支持USB引导的，原因并不是硬件不支持，而是EEPROM固件不支持，此时我们需要手动将"),r("code",[t._v("EEPROM")]),t._v("固件升级到"),r("code",[t._v("2020-09-03")]),t._v("版本，当然，得益于社区支持，以及树莓派4B目前是Ubuntu认证设备，升级EEPROM固件并不是一个复杂的工作，接下来我将会提供两个升级方式供大家选择。")]),t._v(" "),r("p",[t._v("如果你有一张TF卡，并且已经写入了"),r("code",[t._v("Ubuntu Server 20.04 （20.10）")]),t._v("系统，我建议你采用方式1，如果手头的SD卡（TF）卡是空卡，则也可以使用方式2，如果是刚接触小板子的萌新，建议选择方式2。")]),t._v(" "),r("h2",{attrs:{id:"方式1-使用rpi-eeprom"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方式1-使用rpi-eeprom"}},[t._v("#")]),t._v(" 方式1:使用rpi-eeprom")]),t._v(" "),r("ol",[r("li",[t._v("安装"),r("code",[t._v("rpi-eeprom")]),t._v(",如果已安装，建议先更新一下。")])]),t._v(" "),r("div",{staticClass:"language-sh extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -y rpi-eeprom\n")])])]),r("ol",{attrs:{start:"2"}},[r("li",[t._v("将当前引导加载程序配置写入到文本。")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("sudo vcgencmd bootloader_config > bootconf.txt\n")])])]),r("p",[t._v("此时通过cat命令你如果看到如下格式的内容，说明引导配置成功导出了。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("root@Raspberry-Pi4:/home# cat bootconf.txt \n[all]\nBOOT_UART=0\nWAKE_ON_GPIO=1\nPOWER_OFF_ON_HALT=0\nDHCP_TIMEOUT=45000\nDHCP_REQ_TIMEOUT=4000\nTFTP_FILE_TIMEOUT=30000\nENABLE_SELF_UPDATE=1\nDISABLE_HDMI=0\nBOOT_ORDER=0xf41\n\n")])])]),r("ol",{attrs:{start:"3"}},[r("li",[t._v("修改引导模式的优先级，通过sed命令，将"),r("code",[t._v("BOOT_ORDER")]),t._v("选项的值改为"),r("code",[t._v("0xf41")]),t._v("，如果你喜欢nano或者vim也可以使用nano和vim对选项进行修改。")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("sed -i -e '/^BOOT_ORDER=/ s/=.*$/=0xf41/' bootconf.txt\n")])])]),r("p",[r("strong",[t._v("ps：其实"),r("code",[t._v("2020-09-03")]),t._v("版本的"),r("code",[t._v("EEPROM")]),t._v("，"),r("code",[t._v("bootloader")]),t._v("配置默认的"),r("code",[t._v("BOOT_ORDER")]),t._v("值就是"),r("code",[t._v("0xf41")]),t._v(",如果走到这一步你发现这个值已经是"),r("code",[t._v("0xf41了")]),t._v(" ,可以使用"),r("code",[t._v("sudo vcgencmd bootloader_version")]),t._v("命令确认下"),r("code",[t._v("bootloader")]),t._v("版本，如果是"),r("code",[t._v("2020-09-03")]),t._v("版本则无需再更新"),r("code",[t._v("EEPROM")]),t._v("了。命令输出的内容大致长下面这个样")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("root@Raspberry-Pi4:/home# sudo vcgencmd bootloader_version\nSep  3 2020 13:11:43\nversion c305221a6d7e532693cc7ff57fddfc8649def167 (release)\ntimestamp 1599135103\nupdate-time 0\ncapabilities 0x00000000\n")])])]),r("p",[r("strong",[t._v("也可以使用"),r("code",[t._v("sudo rpi-eeprom-update")]),t._v("命令查看"),r("code",[t._v("EEPROM")]),t._v("固件版本。")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("root@Raspberry-Pi4:/home# sudo rpi-eeprom-update\nBCM2711 detected\nVL805 firmware in bootloader EEPROM\nBOOTLOADER: up-to-date\nCURRENT: Thu Sep  3 12:11:43 UTC 2020 (1599135103)\n LATEST: Thu Sep  3 12:11:43 UTC 2020 (1599135103)\n FW DIR: /lib/firmware/raspberrypi/bootloader/default\nVL805: up-to-date\nCURRENT: 000138a1\n LATEST: 000138a1\n")])])]),r("p",[t._v("这里插入点刘同学的碎碎念：这里我来解释下"),r("code",[t._v("0xf41")]),t._v("是个啥意思，毕竟啃了好大一会英文文档，如果不分享给大家，有点点不太好，哈哈哈。")]),t._v(" "),r("p",[t._v("首先是"),r("code",[t._v("0xf")]),t._v("前缀，也就是"),r("code",[t._v("RESTART")]),t._v("模式，他会重复尝试配置的引导顺序，1代表从SD卡启动，4代表从USB存储设备上启动，启动顺序由启动代码从右到左开始尝试，"),r("code",[t._v("0xf41")]),t._v("意味着会优先尝试从SD卡启动，如果没插卡，或者卡上没有系统则尝试从USB存储设备启动，并且按照这个顺序持续尝试。")]),t._v(" "),r("p",[t._v("附表")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("Value")]),t._v(" "),r("th",[t._v("Mode")]),t._v(" "),r("th",[t._v("Description")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("0x1")]),t._v(" "),r("td",[t._v("SD CARD")]),t._v(" "),r("td",[t._v("SD card (or eMMC on Compute Module 4)")])]),t._v(" "),r("tr",[r("td",[t._v("0x2")]),t._v(" "),r("td",[t._v("NETWORK")]),t._v(" "),r("td",[t._v("Network boot")])]),t._v(" "),r("tr",[r("td",[t._v("0x3")]),t._v(" "),r("td",[t._v("RPIBOOT")]),t._v(" "),r("td",[t._v("RPIBOOT -  See "),r("a",{attrs:{href:"https://github.com/raspberrypi/usbboot",title:"usbboot",target:"_blank",rel:"noopener noreferrer"}},[t._v("usbboot"),r("OutboundLink")],1),t._v("  (since 2020-09-03)")])]),t._v(" "),r("tr",[r("td",[t._v("0x4")]),t._v(" "),r("td",[t._v("USB-MSD")]),t._v(" "),r("td",[t._v("USB mass storage boot (since 2020-09-03)")])]),t._v(" "),r("tr",[r("td",[t._v("0x5")]),t._v(" "),r("td",[t._v("BCM-USB-MSD")]),t._v(" "),r("td",[t._v("USB 2.0 boot from USB Type-C socket or USB Type-A socket on CM4 IO board.     (since 2020-12-14)")])]),t._v(" "),r("tr",[r("td",[t._v("0xe")]),t._v(" "),r("td",[t._v("STOP")]),t._v(" "),r("td",[t._v("Stop and display error pattern (since 2020-09-03). A power cycle is required to exit this state.")])]),t._v(" "),r("tr",[r("td",[t._v("0xf")]),t._v(" "),r("td",[t._v("RESTART")]),t._v(" "),r("td",[t._v("Start again with the first boot order field. (since 2020-09-03)")])])])]),t._v(" "),r("p",[t._v("在树莓派基金会官网上，提供了详细的bootloader config文档，如果你有兴趣可以去阅读一下。")]),t._v(" "),r("blockquote",[r("p",[r("a",{attrs:{href:"https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2711_bootloader_config.md",title:"Raspberry Pi 4 bootloader configuration",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspberry Pi 4 bootloader configuration"),r("OutboundLink")],1)])]),t._v(" "),r("ol",{attrs:{start:"4"}},[r("li",[t._v("使用修改后的文本配置生成新的EEPROM副本。")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("rpi-eeprom-config --out pieeprom-new.bin --config bootconf.txt /lib/firmware/raspberrypi/bootloader/critical/pieeprom-2020-09-03.bin\n")])])]),r("ol",{attrs:{start:"5"}},[r("li",[t._v("配置下次重启时输入新的EEPROM固件。")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("sudo rpi-eeprom-update -d -f ./pieeprom-new.bin\n")])])]),r("ol",{attrs:{start:"6"}},[r("li",[t._v("重启以应用更改")])]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("sudo reboot\n")])])]),r("h2",{attrs:{id:"方式2-使用raspberry-pi-imager"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方式2-使用raspberry-pi-imager"}},[t._v("#")]),t._v(" 方式2:使用Raspberry Pi Imager")]),t._v(" "),r("p",[r("a",{attrs:{href:"https://www.raspberrypi.org/software/",title:"Raspberry Pi Imager 可在树莓派基金会官网获取",target:"_blank",rel:"noopener noreferrer"}},[t._v("Raspberry Pi Imager 可在树莓派基金会官网获取"),r("OutboundLink")],1)]),t._v(" "),r("ol",[r("li",[t._v("打开Raspberry Pi Imager，点击CHOOSE OS选择"),r("code",[t._v("Misc Utillty images")])])]),t._v(" "),r("p",[r("img",{attrs:{src:"https://junzhouwechat.oss-cn-hangzhou.aliyuncs.com/1_20210204130703.png",alt:"选择Misc Utillty images"}})]),t._v(" "),r("ol",{attrs:{start:"2"}},[r("li",[t._v("选择2020-9-14版本的EEPROM固件（实际就是2020-09-3版本）")])]),t._v(" "),r("p",[r("img",{attrs:{src:"https://junzhouwechat.oss-cn-hangzhou.aliyuncs.com/2_20210204130703.png",alt:"选择固件"}})]),t._v(" "),r("p",[t._v("3.选择要写入的存储设备（必须是SD/TF卡），刷入，将卡插入树莓派，给树莓派通电即可，大约60s就能完成刷入，之后断电拔卡就行了。")]),t._v(" "),r("h2",{attrs:{id:"哪些系统支持直接从usb存储设备启动？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#哪些系统支持直接从usb存储设备启动？"}},[t._v("#")]),t._v(" 哪些系统支持直接从USB存储设备启动？")]),t._v(" "),r("p",[t._v("首先Raspberry PI OS 是肯定支持的。")]),t._v(" "),r("p",[t._v("Ubuntu 系列，目前直接确认支持的有"),r("code",[t._v("Ubuntu Server 20.10")]),t._v("和"),r("code",[t._v("Ubuntu Desktop 20.10")])]),t._v(" "),r("p",[t._v("至于"),r("code",[t._v("Ubuntu Server 20.04.1")]),t._v("则需要通过一些特殊的方式使其支持，至于这两天要发布的"),r("code",[t._v("Ubuntu Server 20.04.2")]),t._v("我还没测试过，不过大概率的会支持.")]),t._v(" "),r("h2",{attrs:{id:"目前兼容的usb适配器有哪些？"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#目前兼容的usb适配器有哪些？"}},[t._v("#")]),t._v(" 目前兼容的USB适配器有哪些？")]),t._v(" "),r("p",[r("code",[t._v("James A. Chambers")]),t._v("测试并维护了一个支持列表，里面包含了目前已知工作良好以及无法工作的设备列表，我就不直接放列表了，放了页面地址，大家可以自行查看。")]),t._v(" "),r("blockquote",[r("p",[r("a",{attrs:{href:"https://jamesachambers.com/raspberry-pi-4-usb-boot-config-guide-for-ssd-flash-drives/",title:"兼容的usb适配器列表",target:"_blank",rel:"noopener noreferrer"}},[t._v("兼容的usb适配器列表"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=o.exports}}]);